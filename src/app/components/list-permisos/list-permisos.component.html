<div class="table-container fade-in">
  <app-solicitar-permiso></app-solicitar-permiso>

  <mat-toolbar color="primary">
    <span>Lista de Permisos</span>
  </mat-toolbar>

  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <mat-card class="fade-in">
    <mat-form-field>
      <mat-label>Búsqueda</mat-label>
      <input matInput (keyup)="applyFilter($event)" #input autocomplete="off" />
    </mat-form-field>

    <!-- Contenedor con scroll horizontal y animación -->
    <div class="table-container fade-in">
      <table matSort mat-table [dataSource]="dataSource" class="mat-elevation-z5 permisos-table">

        <!-- Columnas -->
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
          <td mat-cell *matCellDef="let element">{{ element.nombre }}</td>
        </ng-container>

        <ng-container matColumnDef="apellido">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Apellido</th>
          <td mat-cell *matCellDef="let element">{{ element.apellido }}</td>
        </ng-container>

        <ng-container matColumnDef="tipo_permiso">
          <th mat-header-cell *matHeaderCellDef>Tipo de Permiso</th>
          <td mat-cell *matCellDef="let element">{{ element.tipo_permiso }}</td>
        </ng-container>

        <ng-container matColumnDef="estado_permiso">
          <th mat-header-cell *matHeaderCellDef>Estado del Permiso</th>
          <td mat-cell *matCellDef="let element">{{ element.estado_permiso }}</td>
        </ng-container>

        <ng-container matColumnDef="documento">
          <th mat-header-cell *matHeaderCellDef>PDF</th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.documento }}</span>
            <button mat-icon-button (click)="descargarArchivo(element.documento)">
              <mat-icon>download</mat-icon>
            </button>
            
          </td>
        </ng-container>
        

        <ng-container matColumnDef="dias">
          <th mat-header-cell *matHeaderCellDef>Días De permiso</th>
          <td mat-cell *matCellDef="let element">{{ element.dias }}</td>
        </ng-container>

        <ng-container matColumnDef="fecha_solicitud">
          <th mat-header-cell *matHeaderCellDef>Fecha de Solicitud</th>
          <td mat-cell *matCellDef="let permiso">{{ permiso.fecha_solicitud | date:'dd/MM/yyyy' }}</td>
        </ng-container>

        <!-- Nueva columna de acciones -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef> Acciones </th>
          <td mat-cell *matCellDef="let element">
            <span
              [ngClass]="{
                'text-success': element.estado_permiso === 'aceptado',
                'text-danger': element.estado_permiso === 'denegado',
                'text-muted': !element.estado_permiso
              }"
            >
              {{ element.estado_permiso || 'Pendiente' }}
            </span>

            <button
              mat-icon-button
              color="primary"
              (click)="cambiarEstado(element.id, 'aceptado')"
              [disabled]="element.estado_permiso === 'aceptado'"
              matTooltip="Aceptar"
            >
              <mat-icon>check</mat-icon>
            </button>

            <button
              mat-icon-button
              color="warn"
              (click)="cambiarEstado(element.id, 'denegado')"
              [disabled]="element.estado_permiso === 'denegado'"
              matTooltip="Denegar"
            >
              <mat-icon>close</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>

    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
  </mat-card>
</div>
